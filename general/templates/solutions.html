{% extends 'head.html' %}

{% load static %}

{% block title%}
    solutions
{% endblock %}

{% block content %}
<div class="wrapper">
    {% include 'header.html' %}
    <main>
        <div class="solutions">
            <div class="solutions__container--medium">
                <div class="solutions__wrapper">
                  <div class="solutions__content">
                    <div class="solutions__list-name list-name">Решения студентов</div>
                    <form class="solutions__search search">
                        <input placeholder="Поиск" type="text" class="search__query">
                        <button type="submit" class="search__icon">
                             <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clip-path="url(#clip0_149_961)">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M7.98107 0.0238063C5.27311 0.366732 2.96396 1.77222 1.49674 3.97049C-0.921453 7.59352 -0.359468 12.4533 2.82088 15.4206C4.50098 16.9881 6.59804 17.8108 8.91355 17.8108C10.9243 17.8108 12.6849 17.2355 14.2446 16.0686L14.8089 15.6464L15.5681 16.3857C15.9857 16.7923 17.4341 18.2215 18.7867 19.5616C21.4522 22.2024 21.4457 22.1976 21.8226 21.8209C21.9386 21.705 22 21.562 22 21.4077C22 21.193 21.7142 20.8857 18.8233 17.9932L15.6465 14.8148L15.7914 14.6343C16.7651 13.4218 17.4819 11.8582 17.7442 10.3748C17.8774 9.62184 17.8558 7.95471 17.7036 7.23428C16.9431 3.63334 14.3666 1.00349 10.7993 0.186895C10.1975 0.0491469 8.53887 -0.0468004 7.98107 0.0238063ZM10.8354 1.45226C11.6301 1.65722 12.6424 2.11414 13.3444 2.58492C13.9586 2.99672 14.9522 4.012 15.3813 4.66594C16.2066 5.92409 16.5775 7.11285 16.6331 8.67818C16.7124 10.9146 16.0159 12.7249 14.46 14.3269C12.9673 15.8637 11.0957 16.6557 8.95662 16.6557C5.91509 16.6557 3.30374 15.0227 1.9723 12.2879C-0.280195 7.66131 2.54845 2.23138 7.69202 1.30844C8.53027 1.15799 9.9456 1.22275 10.8354 1.45226Z" fill="#101923" fill-opacity="0.8"/>
                                    </g>                   
                                    <defs>
                                        <clipPath id="clip0_149_961">
                                        <rect width="22" height="22" fill="white"/>
                                    </clipPath>
                                    </defs>
                                </svg>
                        </button>
                    </form>
                    <ul class="solutions__list">
                        {% for point_id, answer, user_full_name, task_name, task_text in solutions %}
                            <li>
                                <div class="solutions__item solution">
                                    <div class="solution__student-fio">{{ user_full_name }}</div>
                                    <div class="solution__wrapper-accordion-header">
                                        <div class="solution__task-number">{{ task_name }}</div>
                                        <div class="solution__button-expand button-expand">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="8" viewBox="0 0 13 8" fill="none">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M0.343185 0.0648389C0.0965533 0.18287 -0.0411083 0.491195 0.010921 0.809095C0.03304 0.944248 0.380813 1.34029 3.12607 4.3568C5.87137 7.37326 6.23181 7.75539 6.35481 7.77969C6.70502 7.84891 6.50159 8.04752 9.8605 4.3568C13.2184 0.667125 13.04 0.887769 12.9749 0.506775C12.9408 0.307068 12.7199 0.0643522 12.5382 0.026902C12.1929 -0.044306 12.3667 -0.212121 9.30882 3.14456L6.49306 6.23547L3.696 3.16403C2.12943 1.4438 0.853213 0.0739276 0.79498 0.0501916C0.655915 -0.00657195 0.480514 -0.000891544 0.343185 0.0648389Z" fill="white"/>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="solution__text-block">
                                    <div class="solution__text-block-wrapper">
                                        <div class="solution__task-text">{{ task_text }}</div>
                                        <div class="solution__student-query-text">{{ answer }}</div>
                                    </div>
                                    <div class="solution__comment">
                                        <input placeholder="Введите комментарий" type="text" class="solution__comment-text" data-point-id="{{ point_id }}">
                                    </div>
                                    <button class="solution__comment-button comment-button" data-point-id="{{ point_id }}">Комментировать</button>
                                </div>
                            </li>
                        {% endfor %}
                        {% for question_id, question, user_full_name, task_name, task_text in questions %}
                        <li>
                            <div class="solutions__item question">
                                <div class="question__student-fio">Вопрос от: {{ user_full_name }}</div>
                                <div class="question__wrapper-accordion-header">
                                    <div class="question__task-number">{{ task_name }}</div>
                                    <div class="question__button-expand button-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="8" viewBox="0 0 13 8" fill="none">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.343185 0.0648389C0.0965533 0.18287 -0.0411083 0.491195 0.010921 0.809095C0.03304 0.944248 0.380813 1.34029 3.12607 4.3568C5.87137 7.37326 6.23181 7.75539 6.35481 7.77969C6.70502 7.84891 6.50159 8.04752 9.8605 4.3568C13.2184 0.667125 13.04 0.887769 12.9749 0.506775C12.9408 0.307068 12.7199 0.0643522 12.5382 0.026902C12.1929 -0.044306 12.3667 -0.212121 9.30882 3.14456L6.49306 6.23547L3.696 3.16403C2.12943 1.4438 0.853213 0.0739276 0.79498 0.0501916C0.655915 -0.00657195 0.480514 -0.000891544 0.343185 0.0648389Z" fill="white"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="question__text-block">
                                <div class="question__text-block-wrapper">
                                    <div class="question__task-text">Задание: {{ task_text }}</div>
                                    <div class="question__student-question-text">{{ question }}</div>
                                </div>
                                <div class="question__comment">
                                    <input placeholder="Введите комментарий" type="text" class="question__comment-text" data-question-id="{{ question_id }}">
                                </div>
                                <button class="question__comment-button comment-button" data-question-id="{{ question_id }}">Комментировать</button>
                            </div>
                        </li>
                        {% endfor %}
                        {% for question_id, question, comment, task_name in answers %}
                        <li>
                            <div class="solutions__item answer">
                                <div class="answer__student-fio">Ответ на вопрос</div>
                                <div class="answer__wrapper-accordion-header">
                                    <div class="answer__task-number">{{ task_name }}</div>
                                    <div class="answer__button-expand button-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="8" viewBox="0 0 13 8" fill="none">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.343185 0.0648389C0.0965533 0.18287 -0.0411083 0.491195 0.010921 0.809095C0.03304 0.944248 0.380813 1.34029 3.12607 4.3568C5.87137 7.37326 6.23181 7.75539 6.35481 7.77969C6.70502 7.84891 6.50159 8.04752 9.8605 4.3568C13.2184 0.667125 13.04 0.887769 12.9749 0.506775C12.9408 0.307068 12.7199 0.0643522 12.5382 0.026902C12.1929 -0.044306 12.3667 -0.212121 9.30882 3.14456L6.49306 6.23547L3.696 3.16403C2.12943 1.4438 0.853213 0.0739276 0.79498 0.0501916C0.655915 -0.00657195 0.480514 -0.000891544 0.343185 0.0648389Z" fill="white"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="answer__text-block">
                                <div class="answer__text-block-wrapper">
                                    <div class="answer__student-question-text">Вопрос: {{ question }}</div>
                                    <div class="answer__task-text">Ответ: {{ comment }}</div>                                    
                                </div>
                                <button class="answer__comment-button comment-button" data-question-id="{{ question_id }}">Просмотрено</button>
                            </div>
                        </li>
                        {% endfor %}
                        {% for point_id, answer, task_name, comment in comments %}
                        <li>
                            <div class="solutions__item comment">
                                <div class="comment__student-fio">Комментарий к решению</div>
                                <div class="comment__wrapper-accordion-header">
                                    <div class="comment__task-number">{{ task_name }}</div>
                                    <div class="comment__button-expand button-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="8" viewBox="0 0 13 8" fill="none">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0.343185 0.0648389C0.0965533 0.18287 -0.0411083 0.491195 0.010921 0.809095C0.03304 0.944248 0.380813 1.34029 3.12607 4.3568C5.87137 7.37326 6.23181 7.75539 6.35481 7.77969C6.70502 7.84891 6.50159 8.04752 9.8605 4.3568C13.2184 0.667125 13.04 0.887769 12.9749 0.506775C12.9408 0.307068 12.7199 0.0643522 12.5382 0.026902C12.1929 -0.044306 12.3667 -0.212121 9.30882 3.14456L6.49306 6.23547L3.696 3.16403C2.12943 1.4438 0.853213 0.0739276 0.79498 0.0501916C0.655915 -0.00657195 0.480514 -0.000891544 0.343185 0.0648389Z" fill="white"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="comment__text-block">
                                <div class="comment__text-block-wrapper">
                                    <div class="comment__student-question-text">Решение: {{ answer }}</div>
                                    <div class="comment__task-text">Комментарий к решению: {{ comment }}</div>                                    
                                </div>
                                <button class="comment__comment-button comment-button" data-point-id="{{ point_id }}">Просмотрено</button>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                  </div>
                  <div class="solutions__sidebar"></div>
                </div>
            </div>
        </div>
    </main>
    {% include 'footer.html' %}
</div>
{% block javascript %}
<script type="text/javascript" src="{% static 'js/solutions.js' %}"></script>
<script src="https://code.jquery.com/jquery-3.6.4.js"></script>
<script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>

<script>
    $(".solution__comment-button").bind('click', function(){
        var point_index = $(this).attr('data-point-id');
        $.ajax({
          method: 'POST',
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          url:"{% url 'add_comment' %}",
          data: {text_comment:$(".solution__comment-text[data-point-id='" + point_index + "']").val(), 
                 point_id:point_index},
          dataType: 'json',
          success: function(data_response){
          }
        });
    });
</script>

<script>
    $(".answer__comment-button").bind('click', function(){
        var question_index = $(this).attr('data-question-id');
        $.ajax({
          method: 'POST',
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          url:"{% url 'view_answer' %}",
          data: {question_id:question_index},
          dataType: 'json',
          success: function(data_response){
          }
        });
    });
</script>

<script>
    $(".question__comment-button").bind('click', function(){
        var question_index = $(this).attr('data-question-id');
        $.ajax({
          method: 'POST',
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          url:"{% url 'add_answer' %}",
          data: {text_answer:$(".question__comment-text[data-question-id='" + question_index + "']").val(), 
                 question_id:question_index},
          dataType: 'json',
          success: function(data_response){
          }
        });
    });
</script>

<script>
    $(".comment__comment-button").bind('click', function(){
        var point_index = $(this).attr('data-point-id');
        $.ajax({
          method: 'POST',
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          url:"{% url 'view_comment' %}",
          data: {point_id:point_index},
          dataType: 'json',
          success: function(data_response){
          }
        });
    });
</script>


{% endblock javascript %}
{% endblock %}